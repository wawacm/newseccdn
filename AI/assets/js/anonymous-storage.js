if("undefined"==typeof AccessControl){class o{constructor(){this.isLoggedIn=!1,this.anonymousCount=this.loadAnonymousCount(),this.anonymousLimit=5,this.isApiDomain=!1,this.isPublicDomain=!1,this.user=null}loadAnonymousCount(){try{const o=(new Date).toDateString(),n=localStorage.getItem("anonymous_count");if(n){const s=JSON.parse(n);if(s.date===o)return console.log(` 加载今日匿名消息计数: ${s.count}`),s.count||0}return console.log(" 新的一天，重置匿名消息计数"),this.saveAnonymousCount(0),0}catch(o){return console.error("加载匿名计数失败:",o),0}}saveAnonymousCount(o){try{const n=(new Date).toDateString();localStorage.setItem("anonymous_count",JSON.stringify({date:n,count:o})),console.log(` 保存匿名消息计数: ${o}`)}catch(o){console.error("保存匿名计数失败:",o)}}async checkAccess(){try{const o=await fetch("/api/auth/check-access"),n=await o.json();return n.success?(this.isLoggedIn=n.isLoggedIn,this.anonymousCount=n.count||0,this.anonymousLimit=n.limit||5,this.isApiDomain=n.isApiDomain||!1,this.isPublicDomain=n.isPublicDomain||!1,this.user=n.user,this.isApiDomain&&!this.isLoggedIn?{allowed:!1,requireLogin:!0,message:"此API接口需要登录才能使用"}:{allowed:n.allowed,requireLogin:n.requireLogin||!1,message:n.message||""}):{allowed:!0,requireLogin:!1,message:""}}catch(o){return console.error("检查访问权限失败:",o),{allowed:!0,requireLogin:!1,message:""}}}showAnonymousStatus(){if(this.isLoggedIn)return"";const o=this.anonymousLimit-this.anonymousCount;return o<=0?"已达到免费限制，请登录继续使用":`剩余 ${o}/${this.anonymousLimit} 条免费消息`}canSendMessage(){return this.isLoggedIn?{allowed:!0,message:""}:this.isApiDomain?{allowed:!1,requireLogin:!0,message:"此API接口需要登录才能使用"}:this.anonymousCount>=this.anonymousLimit?{allowed:!1,requireLogin:!0,message:`您已达到免费消息限制（${this.anonymousLimit}条），请登录以继续使用`}:{allowed:!0,message:""}}canUsePro(){return this.isLoggedIn?this.user&&this.user.can_use_pro?{allowed:!0,message:""}:{allowed:!1,requireLogin:!1,message:"您没有Pro访问权限"}:{allowed:!1,requireLogin:!0,message:"需要登录才能使用Pro模型"}}updateCount(o){this.anonymousCount=o,this.isLoggedIn||this.saveAnonymousCount(o)}incrementCount(){this.anonymousCount++,this.isLoggedIn||this.saveAnonymousCount(this.anonymousCount),console.log(` 匿名消息计数增加: ${this.anonymousCount}/${this.anonymousLimit}`)}decrementCount(){this.anonymousCount>0&&(this.anonymousCount--,this.isLoggedIn||this.saveAnonymousCount(this.anonymousCount),console.log(` 匿名消息计数回滚: ${this.anonymousCount}/${this.anonymousLimit}`))}showLoginPrompt(o){confirm(o+"\n\n是否现在登录？")&&this.showLoginPage()}showLoginPage(){window.location.reload()}}"undefined"!=typeof window&&void 0===window.AccessControl&&(window.AccessControl=o)}
