class AccessControl{constructor(){this.isLoggedIn=!1,this.anonymousCount=0,this.anonymousLimit=5,this.isApiDomain=!1,this.isPublicDomain=!1,this.user=null}async checkAccess(){try{const s=await fetch("/api/auth/check-access"),i=await s.json();return i.success?(this.isLoggedIn=i.isLoggedIn,this.anonymousCount=i.count||0,this.anonymousLimit=i.limit||5,this.isApiDomain=i.isApiDomain||!1,this.isPublicDomain=i.isPublicDomain||!1,this.user=i.user,this.isApiDomain&&!this.isLoggedIn?{allowed:!1,requireLogin:!0,message:"此API接口需要登录才能使用"}:{allowed:i.allowed,requireLogin:i.requireLogin||!1,message:i.message||""}):{allowed:!0,requireLogin:!1,message:""}}catch(s){return console.error("检查访问权限失败:",s),{allowed:!0,requireLogin:!1,message:""}}}showAnonymousStatus(){if(this.isLoggedIn)return"";const s=this.anonymousLimit-this.anonymousCount;return s<=0?"已达到免费限制，请登录继续使用":`剩余 ${s}/${this.anonymousLimit} 条免费消息`}canSendMessage(){return this.isLoggedIn?{allowed:!0,message:""}:this.isApiDomain?{allowed:!1,requireLogin:!0,message:"此API接口需要登录才能使用"}:this.anonymousCount>=this.anonymousLimit?{allowed:!1,requireLogin:!0,message:`您已达到免费消息限制（${this.anonymousLimit}条），请登录以继续使用`}:{allowed:!0,message:""}}canUsePro(){return this.isLoggedIn?this.user&&this.user.can_use_pro?{allowed:!0,message:""}:{allowed:!1,requireLogin:!1,message:"您没有Pro访问权限"}:{allowed:!1,requireLogin:!0,message:"需要登录才能使用Pro模型"}}updateCount(s){this.anonymousCount=s}showLoginPrompt(s){confirm(s+"\n\n是否现在登录？")&&this.showLoginPage()}showLoginPage(){window.location.reload()}}window.AccessControl=AccessControl;
