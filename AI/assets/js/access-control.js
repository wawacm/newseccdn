if(void 0===window.AccessControl){class o{constructor(){this.isLoggedIn=!1,this.anonymousCount=this.loadAnonymousCount(),this.anonymousLimit=5,this.isApiDomain=!1,this.isPublicDomain=!1,this.user=null}loadAnonymousCount(){try{const o=(new Date).toDateString(),s=localStorage.getItem("anonymous_count");if(s){const n=JSON.parse(s);if(n.date===o)return console.log(`ğŸ“Š åŠ è½½ä»Šæ—¥åŒ¿åæ¶ˆæ¯è®¡æ•°: ${n.count}`),n.count||0}return console.log("ğŸ“Š æ–°çš„ä¸€å¤©ï¼Œé‡ç½®åŒ¿åæ¶ˆæ¯è®¡æ•°"),this.saveAnonymousCount(0),0}catch(o){return console.error("åŠ è½½åŒ¿åè®¡æ•°å¤±è´¥:",o),0}}saveAnonymousCount(o){try{const s=(new Date).toDateString();localStorage.setItem("anonymous_count",JSON.stringify({date:s,count:o})),console.log(`ğŸ’¾ ä¿å­˜åŒ¿åæ¶ˆæ¯è®¡æ•°: ${o}`)}catch(o){console.error("ä¿å­˜åŒ¿åè®¡æ•°å¤±è´¥:",o)}}async checkAccess(){try{const o=await fetch("/api/auth/check-access"),s=await o.json();return s.success?(this.isLoggedIn=s.isLoggedIn,this.anonymousCount=s.count||0,this.anonymousLimit=s.limit||5,this.isApiDomain=s.isApiDomain||!1,this.isPublicDomain=s.isPublicDomain||!1,this.user=s.user,this.isApiDomain&&!this.isLoggedIn?{allowed:!1,requireLogin:!0,message:"æ­¤APIæ¥å£éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨"}:{allowed:s.allowed,requireLogin:s.requireLogin||!1,message:s.message||""}):{allowed:!0,requireLogin:!1,message:""}}catch(o){return console.error("æ£€æŸ¥è®¿é—®æƒé™å¤±è´¥:",o),{allowed:!0,requireLogin:!1,message:""}}}showAnonymousStatus(){if(this.isLoggedIn)return"";const o=this.anonymousLimit-this.anonymousCount;return o<=0?"å·²è¾¾åˆ°å…è´¹é™åˆ¶ï¼Œè¯·ç™»å½•ç»§ç»­ä½¿ç”¨":`å‰©ä½™ ${o}/${this.anonymousLimit} æ¡å…è´¹æ¶ˆæ¯`}canSendMessage(){return this.isLoggedIn?{allowed:!0,message:""}:this.isApiDomain?{allowed:!1,requireLogin:!0,message:"æ­¤APIæ¥å£éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨"}:this.anonymousCount>=this.anonymousLimit?{allowed:!1,requireLogin:!0,message:`æ‚¨å·²è¾¾åˆ°å…è´¹æ¶ˆæ¯é™åˆ¶ï¼ˆ${this.anonymousLimit}æ¡ï¼‰ï¼Œè¯·ç™»å½•ä»¥ç»§ç»­ä½¿ç”¨`}:{allowed:!0,message:""}}canUsePro(){return this.isLoggedIn?this.user&&this.user.can_use_pro?{allowed:!0,message:""}:{allowed:!1,requireLogin:!1,message:"æ‚¨æ²¡æœ‰Proè®¿é—®æƒé™"}:{allowed:!1,requireLogin:!0,message:"éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨Proæ¨¡å‹"}}updateCount(o){this.anonymousCount=o,this.isLoggedIn||this.saveAnonymousCount(o)}incrementCount(){this.anonymousCount++,this.isLoggedIn||this.saveAnonymousCount(this.anonymousCount),console.log(`ğŸ“ˆ åŒ¿åæ¶ˆæ¯è®¡æ•°å¢åŠ : ${this.anonymousCount}/${this.anonymousLimit}`)}decrementCount(){this.anonymousCount>0&&(this.anonymousCount--,this.isLoggedIn||this.saveAnonymousCount(this.anonymousCount),console.log(`ğŸ“‰ åŒ¿åæ¶ˆæ¯è®¡æ•°å›æ»š: ${this.anonymousCount}/${this.anonymousLimit}`))}showLoginPrompt(o){confirm(o+"\n\næ˜¯å¦ç°åœ¨ç™»å½•ï¼Ÿ")&&this.showLoginPage()}showLoginPage(){window.location.reload()}}window.AccessControl=o}
